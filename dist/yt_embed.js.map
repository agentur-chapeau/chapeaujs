{"version":3,"file":"yt_embed.js","sources":["../src/scripts/yt_embed.js"],"sourcesContent":["import { exportChapeau } from \"../utils/export_chapeau\";\n\nconst videoHTML = `\n    <iframe class=\"c-video__iframe\" style=\"display: none\" frameborder=\"0\" allow=\"fullscreen\"></iframe>\n    <img class=\"c-video__thumbnail\">\n    <div class=\"c-video__overlay\">\n        <a href=\"#\" class=\"c-video__button w-button\">Video laden</a>\n        <span class=\"c-video__text\">\n        Das Video wird von YouTube eingebettet.<br>\n        Es gelten die\n        <a class=\"c-video__link\" href=\"https://policies.google.com/privacy?hl=de\"\n            target=\"_blank\">Datenschutzerkl√§rungen</a>\n        von Google.\n        </span>\n    </div>\n`;\n\nfunction getIdFromUrl(urlString) {\n  const url = new URL(urlString);\n  let videoId = url.searchParams.get(\"v\"); // Full URL\n  if (!videoId) {\n    videoId = url.pathname.split(\"/\").slice(-1); // Short URL\n  }\n\n  return videoId;\n}\n\n/** @param {HTMLElement} $el */\nfunction createVideo($el) {\n  $el.classList.add(\"c-video\");\n  $el.innerHTML = videoHTML;\n\n  const $iframe = $el.querySelector(\".c-video .c-video__iframe\");\n  const $thumbnail = $el.querySelector(\".c-video .c-video__thumbnail\");\n  const $overlay = $el.querySelector(\".c-video .c-video__overlay\");\n  const $link = $el.querySelector(\".c-video .c-video__link\");\n\n  const url = $el.dataset.url;\n  const videoId = getIdFromUrl(url);\n\n  const hasThumbnail = $el.dataset.thumbnail != null;\n  if (hasThumbnail) {\n    $thumbnail.src = $el.dataset.thumbnail;\n  } else {\n    $thumbnail.src = `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`;\n    // Check if maxresredefault thumbnail is available\n    $thumbnail.addEventListener(\"load\", () => {\n      if ($thumbnail.naturalHeight <= 90) {\n        // Fallback image from YT is 120x90\n        $thumbnail.src = `http://img.youtube.com/vi/${videoId}/sddefault.jpg`; // Standard thumbnail\n      }\n    });\n  }\n\n  $overlay.addEventListener(\"click\", () => Chapeau.loadVideos());\n  $link.addEventListener(\"click\", (e) => e.stopPropagation());\n\n  // Remove padding-top if webflow yt-embed\n  if ($el.classList.contains(\"w-embed-youtubevideo\")) {\n    $el.style.paddingTop = null;\n  }\n\n  function load() {\n    const embedUrl = `https://www.youtube-nocookie.com/embed/${videoId}`;\n\n    $iframe.src = embedUrl;\n\n    $iframe.style.display = null;\n    $thumbnail.style.display = \"none\";\n    $overlay.style.display = \"none\";\n  }\n\n  return {\n    load,\n  };\n}\n\n// Convert all embedded YT-Elements\nArray.from(\n  document.querySelectorAll(\n    \".w-richtext-figure-type-video > div, .w-embed-youtubevideo\",\n  ),\n).forEach((el) => {\n  const url = el.querySelector(\"iframe\").src;\n  el.setAttribute(\"c-video\", \"\");\n  el.setAttribute(\"data-url\", url);\n});\n\nconst videos = Array.from(document.querySelectorAll(\"[c-video]\")).map(\n  createVideo,\n);\n\nfunction loadVideos() {\n  videos.forEach((video) => video.load());\n  sessionStorage.setItem(\"c-accept_yt\", true);\n}\n\nconst accept = sessionStorage.getItem(\"c-accept_yt\");\nif (accept == \"true\") {\n  loadVideos();\n}\n\n// Exports\nexportChapeau({\n  loadVideos,\n});\n"],"names":[],"mappings":";AAEA,MAAM,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAelB,SAAS,aAAa,WAAW;AAC/B,QAAM,MAAM,IAAI,IAAI,SAAS;AAC7B,MAAI,UAAU,IAAI,aAAa,IAAI,GAAG;AACtC,MAAI,CAAC,SAAS;AACZ,cAAU,IAAI,SAAS,MAAM,GAAG,EAAE,MAAM,EAAE;AAAA,EAC3C;AAED,SAAO;AACT;AAGA,SAAS,YAAY,KAAK;AACxB,MAAI,UAAU,IAAI,SAAS;AAC3B,MAAI,YAAY;AAEhB,QAAM,UAAU,IAAI,cAAc,2BAA2B;AAC7D,QAAM,aAAa,IAAI,cAAc,8BAA8B;AACnE,QAAM,WAAW,IAAI,cAAc,4BAA4B;AAC/D,QAAM,QAAQ,IAAI,cAAc,yBAAyB;AAEzD,QAAM,MAAM,IAAI,QAAQ;AACxB,QAAM,UAAU,aAAa,GAAG;AAEhC,QAAM,eAAe,IAAI,QAAQ,aAAa;AAC9C,MAAI,cAAc;AAChB,eAAW,MAAM,IAAI,QAAQ;AAAA,EACjC,OAAS;AACL,eAAW,MAAM,8BAA8B,OAAO;AAEtD,eAAW,iBAAiB,QAAQ,MAAM;AACxC,UAAI,WAAW,iBAAiB,IAAI;AAElC,mBAAW,MAAM,6BAA6B,OAAO;AAAA,MACtD;AAAA,IACP,CAAK;AAAA,EACF;AAED,WAAS,iBAAiB,SAAS,MAAM,QAAQ,WAAY,CAAA;AAC7D,QAAM,iBAAiB,SAAS,CAAC,MAAM,EAAE,gBAAe,CAAE;AAG1D,MAAI,IAAI,UAAU,SAAS,sBAAsB,GAAG;AAClD,QAAI,MAAM,aAAa;AAAA,EACxB;AAED,WAAS,OAAO;AACd,UAAM,WAAW,0CAA0C,OAAO;AAElE,YAAQ,MAAM;AAEd,YAAQ,MAAM,UAAU;AACxB,eAAW,MAAM,UAAU;AAC3B,aAAS,MAAM,UAAU;AAAA,EAC1B;AAED,SAAO;AAAA,IACL;AAAA,EACJ;AACA;AAGA,MAAM;AAAA,EACJ,SAAS;AAAA,IACP;AAAA,EACD;AACH,EAAE,QAAQ,CAAC,OAAO;AAChB,QAAM,MAAM,GAAG,cAAc,QAAQ,EAAE;AACvC,KAAG,aAAa,WAAW,EAAE;AAC7B,KAAG,aAAa,YAAY,GAAG;AACjC,CAAC;AAED,MAAM,SAAS,MAAM,KAAK,SAAS,iBAAiB,WAAW,CAAC,EAAE;AAAA,EAChE;AACF;AAEA,SAAS,aAAa;AACpB,SAAO,QAAQ,CAAC,UAAU,MAAM,KAAM,CAAA;AACtC,iBAAe,QAAQ,eAAe,IAAI;AAC5C;AAEA,MAAM,SAAS,eAAe,QAAQ,aAAa;AACnD,IAAI,UAAU,QAAQ;AACpB;AACF;AAGA,cAAc;AAAA,EACZ;AACF,CAAC;"}